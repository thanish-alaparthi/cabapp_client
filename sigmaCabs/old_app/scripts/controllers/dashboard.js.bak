/*
Name: easyBookingApp
Description: Main Application module controller for dashboard page.
Date: 13Nov2013
Author: Mario::216mario216@gmail.com
*/

'use strict';

angular.module('sigmaCabsApp')
	.run(function(AuthenticationService, $window, URLService, $rootScope) {
		// check for userSession.. and redirect to login screen if session dznt exists.
		AuthenticationService.getSession()
			.success(function(oData) {
				$rootScope.$broadcast('userInfoFromSession', {
					"displayName": "Mario Ray",
					"role": 1,
					"id": 234565434
				});
				return;
				if (oData.status != 200) {
					$window.location = URLService.page('logout');

				} else {
					// trigger the event to show all the userName
					$rootScope.$broadcast('userInfoFromSession', oData.result.userInfo);

				}
			})
	})
	.controller('dashboardController', function($scope, $rootScope, URLService, $dialog, modalWindow) {

		var scope = $scope
		/* Add Views to the dashboard */
		//$scope.searchBox = URLService.view('searchBox'); // attach SearchBox view
		$scope.customerList = URLService.view('customerList'); // attach customerList Grid View
		//$scope.customerBookingTabs = URLService.view('customerBookingTabs'); // attach CustBookingTabs View
		/*
			Method: Opens a modal window
			Params : None
		*/

		scope.addEmployee = function() {
			$scope.opts = {
				templateUrl: 'views/users/usersModal.html',
				controller: 'usersAddUpdateController',
				dialogClass: 'modalClass',
				resolve: {
					editMode: [
						function() {
							return false;
						}
					],
					oUser : function(){
						return {"userId" : null}
					}
				}
			};
			modalWindow.addDataToModal($scope.opts);
		};

		scope.close = function() {
			dialog.close();
		}


		// fn: fnAddVehicle
		// opens add vechicle modal window
		scope.fnAddVehicle = function() {
			$scope.opts = {
				templateUrl: 'views/vehicles/vehicleModal.html',
				controller: 'vehicleAddUpdateController',
				dialogClass: 'modalClass',
				resolve: {
					editMode: [
						function() {
							return false;
						}
					],
					oVehicle : function(){
						return {"vehicleId" : null}
					}
				}
			};
			modalWindow.addDataToModal($scope.opts);
		};

		scope.close = function() {
			dialog.close();
		}

		// /* Adding Dialog box options*/
		// $scope.opts = {
		// 	backdrop: true,
		// 	keyboard: true,
		// 	backdropClick: true,
		// 	templateUrl: 'test.html', // OR: templateUrl: 'path/to/view.html',
		// 	controller: 'EditorController',
		// 	resolve: {
		// 		oData: function() {
		// 			return {
		// 				firstName: "first Name",
		// 				lastName: "Last Name"
		// 			};
		// 		}
		// 	}
		// };

		// $scope.login = function() {
		// 	var d = $dialog.dialog($scope.opts);
		// 	d.open();
		// }

	});